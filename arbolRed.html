<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Red de Acci√≥n Masiva - Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Inter:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lucide-static@0.349.0/dist/lucide.css" />
  <style>
    :root {
      --primary: #2563eb;
      --accent: #22c55e;
      --sidebar: #0f172a;
      --sidebar-active: #2563eb;
      --bg: linear-gradient(135deg, #ecf0fa 0%, #f5fbff 100%);
      --card-bg: #f8faff;
      --glass: rgba(255,255,255,0.60);
      --surface: #fff;
      --success-bg: #e2fbe2;
      --success-txt: #15803d;
      --shadow-soft: 0 8px 24px 0 #dde8fc, 0 1.5px 0 #fff inset, 0 0.5px 2.5px #b9c6d8 inset;
      --shadow-neu: 8px 8px 16px #dde5f0, -8px -8px 18px #fff;
      --radius: 28px;
      --radius-md: 20px;
      --radius-sm: 14px;
      --node: 92px;
      --gap: 24px;
      --transition: 0.16s cubic-bezier(.6,.2,.29,.97);
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Inter', Arial, sans-serif;
      background: var(--bg);
      color: #23272f;
    }
    body {
      display: flex;
      min-height: 100vh;
      overflow-x: hidden;
    }
    .sidebar {
      background: var(--sidebar);
      color: #fff;
      width: 210px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      padding: 32px 0 24px 0;
      box-shadow: var(--shadow-soft);
      border-radius: 0 var(--radius) var(--radius) 0;
      position: relative;
    }
    .sidebar .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Montserrat', sans-serif;
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 42px;
      letter-spacing: 1.5px;
      gap: 12px;
      color: var(--primary);
    }
    .sidebar .logo::before {
      content: '';
      display: block;
      width: 32px; height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      box-shadow: 0 4px 18px #dde8fc, 0 0 0 4px #fff;
    }
    .sidebar nav {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .sidebar nav a {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 11px 32px;
      text-decoration: none;
      color: #cbd5e1;
      font-weight: 500;
      border-left: 4px solid transparent;
      border-radius: 0 var(--radius-md) var(--radius-md) 0;
      box-shadow: 0 1.5px 0 #fff inset, 0 0.5px 2.5px #b9c6d8 inset;
      transition: background var(--transition), color var(--transition), border-color var(--transition);
    }
    .sidebar nav a.active, .sidebar nav a:hover {
      background: rgba(37,99,235,0.13);
      color: #fff;
      border-color: var(--sidebar-active);
      box-shadow: 0 2px 10px #2563eb19, 0 1.5px 0 #fff inset;
    }
    .sidebar .logout {
      margin: 32px 0 0 0;
      display: flex; justify-content: center;
    }
    .sidebar .logout button {
      background: none; border: none; color: #94a3b8;
      font-size: 1.05rem; cursor: pointer;
      display: flex; align-items: center; gap: 7px;
      border-radius: var(--radius-sm);
      padding: 5px 13px;
      box-shadow: 0 1.5px 0 #fff inset, 0 0.5px 2.5px #b9c6d8 inset;
      transition: color 0.18s, background .12s;
    }
    .sidebar .logout button:hover { color: #fff; background: #233262; }
    .dashboard-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .main-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 26px 44px 18px 44px;
      border-bottom: 1.5px solid #e6ecf5;
      background: #f6faffd8;
      box-shadow: var(--shadow-soft);
      position: sticky;
      top: 0;
      z-index: 22;
      backdrop-filter: blur(7px);
      border-radius: 0 0 var(--radius-md) var(--radius-md);
    }
    .main-header .title {
      font-family: 'Montserrat',sans-serif;
      font-size: 1.38rem;
      font-weight: 700;
      letter-spacing: 1px;
      color: var(--primary);
      filter: drop-shadow(0 1.5px 0 #fff);
    }
    .metrics-row {
      display: flex;
      gap: 18px;
      margin: 18px 0 6px 0;
      padding: 0 36px;
      justify-content: flex-start;
      flex-wrap: wrap;
    }
    .metric-card {
  background: var(--card-bg);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-neu);
  padding: 10px 15px 10px 13px; /* m√°s compacto */
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  min-width: 100px;
  max-width: 130px;
  position: relative;
  transition: transform .12s, box-shadow .14s;
  border: 1.6px solid #f0f4fa;
}
    .metric-card:hover {
      transform: translateY(-5px) scale(1.045);
      box-shadow: 0 24px 44px #dde5f0, 0 1.5px 0 #fff inset;
      background: #f3f8ff;
    }
    .metric-title {
      font-size: 1.01rem;
      font-weight: 600;
      opacity: .84;
      margin-bottom: 4px;
      display: flex; align-items: center; gap: 8px;
    }
    .metric-value {
      font-size: 1.06rem;
      font-weight: 700;
      color: var(--primary);
      letter-spacing: .38px;
      margin-bottom: 1px;
      line-height: 1.18;
      filter: drop-shadow(0 1.2px 0 #fff);
    }
    .metric-card.total { background: var(--success-bg); color: var(--success-txt); border-color: #b5f5d1;}
    .metric-card.total .metric-value { color: var(--success-txt);}
    .search-box {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .search-box input {
      font-size: 1.1rem;
      padding: 11px 18px;
      border-radius: var(--radius-sm);
      border: 1.7px solid #e2eaf5;
      background: #f9fcff;
      outline: none;
      box-shadow: var(--shadow-neu);
      transition: border .13s, box-shadow .13s;
      width: 170px;
    }
    .search-box input:focus {
      border: 1.9px solid var(--primary);
      box-shadow: 0 2px 11px #2563eb22;
    }
    .search-box button {
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: var(--radius-sm);
      font-weight: 700;
      padding: 11px 22px;
      font-size: 1.07rem;
      cursor: pointer;
      box-shadow: var(--shadow-soft);
      transition: background .12s, box-shadow .12s;
    }
    .search-box button:active { background: #1d4ed8; }
    .search-box button[disabled] { opacity: .62; cursor: not-allowed;}
    .glass-card {
      width: 99%;
      max-width: 1200px;
      background: var(--card-bg);
      margin: 0 auto;
      margin-top: 6px;
      border-radius: var(--radius);
      box-shadow: var(--shadow-neu);
      padding: 26px 22px 44px 22px;
      min-height: 370px;
      position: relative;
      transition: box-shadow .11s;
      backdrop-filter: blur(7px);
      overflow-x: auto;
      border: 1.8px solid #eef3fb;
    }
    .arbol {
      display: flex; flex-direction: column; align-items: center;
      width: 100%;
      margin-top: 10px;
      --current-scale: var(--scale,1);
    }
    .nivel {
      position: relative;
      transform-origin: top center;
      margin: 18px 0;
      transform: scaleX(var(--current-scale)) scaleY(1);
    }
    .fila {
      display: flex; justify-content: center; gap: var(--gap);
    }
    /* NODOS NORMALES M√ÅS LLAMATIVOS */
    .nodo {
      width: var(--node);
      height: var(--node);
      border-radius: 50%;
      border: 2.4px solid #2563eb;    /* azul fuerte */
      background: #e0eaff;            /* celeste intenso, m√°s notorio */
      box-shadow: 0 4px 16px #2563eb2b, 0 0.5px 2.5px #b9c6d8 inset;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 4px;
      font-size: .86rem;
      color: #0a2174;                 /* azul oscuro */
      transition: box-shadow .14s, border-color .13s, background .14s;
      cursor: pointer;
      font-family: 'Montserrat',sans-serif;
      position: relative;
      overflow: hidden;
    }
    .nodo:hover {
      box-shadow: 0 16px 36px #2563eb42, 0 3px 0 #fff inset;
      background: #b6d4fb;    /* azul celeste m√°s intenso al pasar el mouse */
      border-color: #1e40af;  /* azul a√∫n m√°s oscuro al hover */
      z-index: 2;
    }
    /* NODO RA√çZ SE MANTIENE DIFERENTE */
    .nodo.raiz {
      background: linear-gradient(135deg, var(--primary), var(--accent));
      border-color: #d1ffeb;
      color: #fff;
      box-shadow: 0 16px 32px #c3ffea55, 0 2px 10px #dde8fc inset;
      font-size: .98rem;
      font-weight: bold;
      text-shadow: 0 2px 10px #1d4ed855;
    }
    .nodo .nombre { font-weight: 700; line-height: 1.06; margin-bottom: 2px; }
    .nodo .codigo { font-size: .73rem; opacity: .89; }
    .nodo .paq { font-size: .76rem; color: #0ea5e9; }
    .vacio {
      border-style: dashed; border-color: #93c5fd;
      background: #f1f5fe; color: #93c5fd;
      font-size: 1.7rem; line-height: calc(var(--node) - 4px);
      cursor: default !important;
      pointer-events: none;
      box-shadow: 0 0 0 #fff;
    }
    .conectores {
      display: flex; justify-content: center;
      gap: calc(var(--gap) + var(--node) - 46px);
      height: 16px; margin-top: 6px;
    }
    .conectores span {
      display: block; width: 46px; border-bottom: 2.2px solid #d3dcef;
    }
    .nav-buttons {
      display: flex;
      gap: 12px;
      margin-bottom: 18px;
    }
    .nav-buttons button {
      background: #f4faff;
      border: 1.7px solid #d8e2f2;
      color: var(--primary);
      padding: 10px 21px;
      border-radius: var(--radius-sm);
      font-size: 1.03rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 4px 4px 12px #e3ebfa, -2px -2px 6px #fff;
      transition: background .12s, color .13s, border-color .12s, box-shadow .13s;
    }
    .nav-buttons button:hover {
      background: var(--primary);
      color: #fff;
      border-color: #90c4ff;
      box-shadow: 0 8px 24px #c6dbf1;
    }
    #mensajeError {
      color: #e11d48;
      margin-top: 13px;
      text-align: center;
      min-height: 20px;
      font-size: 1.08rem;
      border-radius: 8px;
    }
    @media (max-width: 1100px) {
      .metrics-row { gap: 10px; }
      .main-header, .metrics-row { padding-left: 12px; padding-right: 12px;}
    }
    @media (max-width:900px) {
      .sidebar { width: 60px; min-width: 60px;}
      .sidebar .logo { font-size: 0; }
      .sidebar .logo::before { width: 24px; height: 24px;}
      .sidebar nav a span, .sidebar .logout span { display: none;}
      .sidebar nav a { padding: 11px 9px;}
    }
    @media (max-width:800px) {
      .metrics-row { flex-wrap: wrap; }
      .main-header, .metrics-row { padding-left: 2vw; padding-right: 2vw;}
      .glass-card { padding-left: 2vw; padding-right: 2vw;}
    }
    @media (max-width:600px) {
      .glass-card { min-width: 98vw; }
      .nodo { font-size: .73rem; }
      .main-header { font-size: .91rem;}
    }
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="logo">Red Acci√≥n <span></span></div>
    <nav>
      <a class="active" href="#"><i class="lucide lucide-network"></i><span>Principal</span></a>
      <a href="#"><i class="lucide lucide-bar-chart"></i><span>M√©tricas</span></a>
      <a href="#"><i class="lucide lucide-users"></i><span>Red</span></a>
      <a href="#"><i class="lucide lucide-list"></i><span>Registros</span></a>
      <a href="#"><i class="lucide lucide-settings"></i><span>Configuraci√≥n</span></a>
    </nav>
    <div class="logout">
      <button><i class="lucide lucide-log-out"></i><span>Salir</span></button>
    </div>
  </aside>
  <section class="dashboard-content">
    <div class="main-header">
      <span class="title">As√≠ va tu red</span>
      <div class="search-box">
        <input type="text" id="codigo" placeholder="RM-0000" />
        <button id="verBtn" onclick="generarArbol()">Buscar</button>
      </div>
    </div>
    <div class="metrics-row">
      <div class="metric-card">
        <span class="metric-title"><i class="lucide lucide-users"></i>Personas en red</span>
        <span class="metric-value" id="metric-personas">-</span>
      </div>
      <div class="metric-card">
        <span class="metric-title"><i class="lucide lucide-bar-chart"></i>Niveles completos</span>
        <span class="metric-value" id="metric-niveles">-</span>
      </div>
      <div class="metric-card">
        <span class="metric-title"><i class="lucide lucide-arrow-left"></i>Puntos Izq</span>
        <span class="metric-value" id="metric-izq">-</span>
      </div>
      <div class="metric-card">
        <span class="metric-title"><i class="lucide lucide-arrow-right"></i>Puntos Der</span>
        <span class="metric-value" id="metric-der">-</span>
      </div>
      <div class="metric-card total">
        <center><span class="metric-title"><i class="lucide lucide-trophy"></i>Dinero Puntos</span></center>
        <span class="metric-value" id="metric-total">-</span>
      </div>
      <div class="metric-card total">
        <center><span class="metric-title"><i class="lucide lucide-gift"></i>Dinero Bonos</span></center>
        <span class="metric-value" id="metric-bonos">-</span>
    </div>
    </div>
    </div>
    </div>
    <div class="glass-card">
      <div id="navButtons" class="nav-buttons"></div>
      <div id="arbolRed" class="arbol"></div>
      <div id="mensajeError"></div>
    </div>
  </section>
  <script>
    const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRusO2GcoYUtkgNYArBk_q8ApISe1IZodp9PoNYDfMVuZ2Vrs8T6InJNLCvOHTj-Mww1sEcGk33EHAR/pub?output=csv';
    let registros = [], nivelesData = [], raizGlobal = null, initialRoot = null, historyStack = [];
    const MAX_DESC = 3;
    const limpiarTexto = t => (t||'').replace(/\"/g,'').trim();
    function buscarPorPatrocinador(p){ return registros.filter(x=>limpiarTexto(x.Patrocinador)===limpiarTexto(p)).slice(0,2); }
    function getPorCodigo(c){ return registros.find(x=>limpiarTexto(x['C√≥digo Asignado'])===limpiarTexto(c)); }
    function puntosPorPaquete(p){ switch(limpiarTexto(p).toUpperCase()){ case 'ESP 1': return 100; case 'ESP 2': return 250; case 'ESP 3': return 500; default: return 0; } }
    function contarPuntosRama(nodo,nivel,maxNivel){ if(!nodo||nivel>maxNivel) return 0; const hijos = buscarPorPatrocinador(nodo['C√≥digo Asignado']); let total = puntosPorPaquete(nodo.Paquete); for(const h of hijos) total += contarPuntosRama(h,nivel+1,maxNivel); return total; }
    function contarRed(nodo,nivel,maxNivel){ if(!nodo||nivel>maxNivel) return 0; const hijos = buscarPorPatrocinador(nodo['C√≥digo Asignado']); let total = hijos.length; for(const h of hijos) total += contarRed(h,nivel+1,maxNivel); return total; }
    function nivelesCompletos(nodo,nivel,maxNivel){ if(!nodo||nivel>maxNivel) return nivel-1; const hijos = buscarPorPatrocinador(nodo['C√≥digo Asignado']); if(hijos.length<2) return nivel-1; return Math.min(nivelesCompletos(hijos[0],nivel+1,maxNivel), nivelesCompletos(hijos[1],nivel+1,maxNivel)); }
    function construirNiveles(nodos, lvlActual, maxDesc){ const niveles=[]; (function rec(actual,lvl){ niveles.push([...actual]); if(lvl===maxDesc) return; const siguiente=[]; actual.forEach(n => { if(!n){ siguiente.push(null,null); } else { const h = buscarPorPatrocinador(n['C√≥digo Asignado']); siguiente.push(h[0]||null,h[1]||null); } }); rec(siguiente,lvl+1); })(nodos,lvlActual); return niveles; }
    function generarArbol(){
      const codigo = document.getElementById('codigo').value.trim();
      const btn = document.getElementById('verBtn');
      document.getElementById('mensajeError').innerText='';
      document.getElementById('arbolRed').innerHTML='';
      document.getElementById('navButtons').style.display='none';
      if(!codigo){ document.getElementById('mensajeError').innerText='Debes ingresar tu c√≥digo asignado.'; return; }
      btn.disabled=true; const original=btn.innerText; btn.innerText='Buscando...';
      fetch(SHEET_CSV_URL)
        .then(r=>r.text())
        .then(csv=>{
          const filas = csv.split('\n');
          const headers = filas[0].split(',').map(limpiarTexto);
          registros = filas.slice(1).map(row=>{ const cols=row.split(','); const obj={}; headers.forEach((k,i)=>obj[k]=limpiarTexto(cols[i])); return obj; });
          const raiz = getPorCodigo(codigo);
          raizGlobal = raiz;
          initialRoot = raiz;
          historyStack = [];
          if(!raiz){ document.getElementById('mensajeError').innerText='No se encontr√≥ el c√≥digo en la base de datos.'; btn.disabled=false; btn.innerText=original; return; }
          updateTreeView();
          btn.disabled=false; btn.innerText=original;
        })
        .catch(err=>{ console.error(err); document.getElementById('mensajeError').innerText='No se pudo consultar la base de datos.'; btn.disabled=false; btn.innerText=original; });
    }
    function updateTreeView() {
  const raiz = raizGlobal;
  const hijos = buscarPorPatrocinador(raiz['C√≥digo Asignado']);
  const izq   = hijos[0] ? contarPuntosRama(hijos[0], 1, MAX_DESC) : 0;
  const der   = hijos[1] ? contarPuntosRama(hijos[1], 1, MAX_DESC) : 0;
  const nivComp  = nivelesCompletos(raiz, 1, MAX_DESC);
  const personas = contarRed(raiz, 1, MAX_DESC);

  // Mostrar puntos normales
  document.getElementById('metric-personas').textContent = personas;
  document.getElementById('metric-niveles').textContent = nivComp;
  document.getElementById('metric-izq').textContent = izq;
  document.getElementById('metric-der').textContent = der;

  // Calcular GANANCIA en USD (lado menor x % paquete)
  let menor = Math.min(izq, der);
  let porcentaje = 0.10; // Default ESP 1

  const paquete = (raiz.Paquete || "").toUpperCase();
  if (paquete.includes("ESP 2")) porcentaje = 0.15;
  else if (paquete.includes("ESP 3")) porcentaje = 0.17;

  const ganancia = menor * porcentaje;

  // Mostrar como dinero formateado
  document.getElementById('metric-total').textContent =
    "$" + ganancia.toLocaleString("en-US", {minimumFractionDigits: 2, maximumFractionDigits: 2}) + " USD";

  nivelesData = construirNiveles([raiz], 0, MAX_DESC);
  renderArbol();
  renderNavButtons();
}
    // ==== C√°lculo Dinero Bonos Generacionales ====

// 1. Mapeo de bonos por paquete y generaci√≥n (GEN1-GEN5)
const BONOS_TABLA = {
  "ESP 1": [25, 5, 5, 5, 10],
  "ESP 2": [75, 10, 10, 10, 20],
  "ESP 3": [150, 20, 20, 20, 40]
};

// 2. Funci√≥n para obtener los nodos por generaci√≥n (GEN1 a GEN5)
function getGeneracionNodos(raiz, gen, maxGen) {
  // Retorna array de arrays: [ [GEN1], [GEN2], [GEN3], [GEN4], [GEN5] ]
  let niveles = [];
  let actual = [raiz];
  for(let g=1; g<=maxGen; g++) {
    let sig = [];
    actual.forEach(nodo => {
      if (!nodo) return;
      const hijos = buscarPorPatrocinador(nodo['C√≥digo Asignado']);
      sig.push(...hijos.filter(h=>h));
    });
    niveles.push(sig);
    actual = sig;
  }
  return niveles; // Array con 5 arrays, cada uno de una gen
}

// 3. Calcular el bono total
let bonoTotal = 0;
const paqueteTabla = ["ESP 1", "ESP 2", "ESP 3"];
const generaciones = getGeneracionNodos(raiz, 1, 5);

generaciones.forEach((arrGen, idxGen) => {
  arrGen.forEach(nodo => {
    const p = (nodo.Paquete || "").toUpperCase();
    let valor = 0;
    // Detectar el paquete del afiliado, buscar en tabla
    if (p.includes("ESP 3")) valor = BONOS_TABLA["ESP 3"][idxGen];
    else if (p.includes("ESP 2")) valor = BONOS_TABLA["ESP 2"][idxGen];
    else if (p.includes("ESP 1")) valor = BONOS_TABLA["ESP 1"][idxGen];
    bonoTotal += valor;
  });
});

// 4. Mostrarlo en el cuadro "Dinero Bonos"
document.getElementById('metric-bonos').textContent =
  "$" + bonoTotal.toLocaleString("en-US", {minimumFractionDigits: 2, maximumFractionDigits: 2}) + " USD";

    function renderArbol(){
      const cont = document.getElementById('arbolRed');
      cont.innerHTML = '';
      const descendantLevels = Math.min(MAX_DESC, nivelesData.length - 1);
      const nivelesAMostrar = descendantLevels + 1;
      for(let i=0; i<nivelesAMostrar; i++){
        const nivelDiv = document.createElement('div');
        nivelDiv.className = 'nivel';
        const fila = document.createElement('div'); fila.className = 'fila';
        nivelesData[i].forEach(nodo => {
          fila.innerHTML += nodo
            ? `<div class='nodo ${i===0? 'raiz': ''}'><div class='nombre'>${nodo.Nombre||''}</div><div class='codigo'>${nodo['C√≥digo Asignado']||''}</div><div class='paq'>${nodo.Paquete||''}</div></div>`
            : `<div class='nodo vacio'>+</div>`;
        });
        nivelDiv.appendChild(fila);
        if(i < nivelesAMostrar - 1){
          const cons = document.createElement('div'); cons.className = 'conectores';
          for(let k=0; k<nivelesData[i].length; k++) cons.innerHTML += '<span></span>';
          nivelDiv.appendChild(cons);
        }
        cont.appendChild(nivelDiv);
      }
      ajustarEscalaGlobal(nivelesAMostrar);
      cont.querySelectorAll('.nodo').forEach(el => {
        if(!el.classList.contains('vacio')){
          el.onclick = () => {
            const codeEl = el.querySelector('.codigo');
            const code = codeEl ? codeEl.innerText : null;
            if(code){
              historyStack.push(raizGlobal['C√≥digo Asignado']);
              const nodo = getPorCodigo(code);
              if(nodo){ raizGlobal = nodo; updateTreeView(); }
            }
          };
        }
      });
    }
    function ajustarEscalaGlobal(nivelesAMostrar){
      const container = document.querySelector('.glass-card');
      const available = container.clientWidth - 32;
      const nodeSize = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--node'));
      const gap = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--gap'));
      let maxNodes = 0;
      for(let i=0; i<nivelesAMostrar; i++) maxNodes = Math.max(maxNodes, nivelesData[i].length);
      const required = maxNodes * nodeSize + (maxNodes - 1) * gap;
      let scale = available / required;
      scale = scale > 1 ? 1 : (scale < 0.45 ? 0.45 : scale);
      document.documentElement.style.setProperty('--scale', scale.toString());
    }
    function renderNavButtons(){
      const nav = document.getElementById('navButtons'); nav.innerHTML = '';
      if(historyStack.length > 0){
        const backBtn = document.createElement('button'); backBtn.innerText = '‚Üê Anterior'; backBtn.onclick = goBack;
        const homeBtn = document.createElement('button'); homeBtn.innerText = 'üè† Inicio'; homeBtn.onclick = goHome;
        nav.appendChild(backBtn); nav.appendChild(homeBtn); nav.style.display = 'flex';
      } else {
        nav.style.display = 'none';
      }
    }
    function goBack(){ const prev = historyStack.pop(); if(prev){ const nodo = getPorCodigo(prev); if(nodo){ raizGlobal = nodo; updateTreeView(); } }}
    function goHome(){ raizGlobal = initialRoot; historyStack = []; updateTreeView(); }
    window.addEventListener('resize', ()=>{ if(nivelesData.length) renderArbol(); });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/lucide@0.349.0/dist/umd/lucide.min.js"></script>
  <script>
    window.addEventListener("DOMContentLoaded",()=>{ lucide.createIcons(); });
  </script>
  <footer style="
  position: fixed;
  left: 210px; /* igual al ancho del sidebar */
  bottom: 0;
  right: 0;
  background: #f8faff;
  color: #94a3b8;
  font-size: 1.06rem;
  text-align: center;
  padding: 14px 0 12px 0;
  letter-spacing: 0.3px;
  border-top: 1.5px solid #e6ecf5;
  box-shadow: 0 -4px 20px #dde8fc2c;
  border-radius: 22px 22px 0 0;
  z-index: 100;
">
  ¬© 2025 Red de Acci√≥n Masiva. Todos los derechos reservados.<br>
  Creado con üíô por Duvan Molina
</footer>
</body>
</html>
